# 设计新闻推送系统

## 🎯 核心知识点

- 推拉模式设计
- 时间线生成算法  
- 个性化推荐
- 缓存策略优化
- 实时性保证

## 📊 系统整体架构

```mermaid
graph TB
    A[客户端] --> B[CDN/负载均衡]
    B --> C[API网关]
    
    subgraph "核心服务"
        C --> D[用户服务]
        C --> E[内容服务]
        C --> F[推送服务]
        C --> G[推荐服务]
    end
    
    subgraph "数据存储"
        H[(用户数据库)]
        I[(内容数据库)]
        J[(关系图数据库)]
        K[时间线缓存]
        L[内容缓存]
    end
    
    D --> H
    E --> I
    F --> J
    F --> K
    E --> L
```

## 💡 面试题目

### **初级** 推拉模式对比
**题目：** 设计Twitter/微博的时间线功能，对比推模式和拉模式的优缺点。

**答案要点：**

```mermaid
graph LR
    A[时间线生成] --> B[推模式Push]
    A --> C[拉模式Pull] 
    A --> D[混合模式]
    
    B --> B1[写时扇出]
    B --> B2[预生成时间线]
    B --> B3[读取快速]
    
    C --> C1[读时合并]
    C --> C2[实时生成]
    C --> C3[存储节省]
    
    D --> D1[热门用户拉模式]
    D --> D2[普通用户推模式]
    D --> D3[平衡性能和存储]
```

**模式对比分析：**

| 维度 | 推模式(Push) | 拉模式(Pull) | 混合模式 |
|------|-------------|-------------|----------|
| 读取性能 | 快速 | 较慢 | 中等 |
| 写入性能 | 慢 | 快速 | 中等 |
| 存储成本 | 高 | 低 | 中等 |
| 实时性 | 好 | 一般 | 好 |
| 扩展性 | 复杂 | 简单 | 中等 |

### **中级** 个性化推荐算法
**题目：** 如何实现个性化的新闻推送？包括内容相关性计算和用户兴趣建模。

**答案要点：**

```mermaid
graph TD
    A[个性化推荐] --> B[用户画像]
    A --> C[内容分析]
    A --> D[推荐算法]
    A --> E[效果评估]
    
    B --> B1[基础属性]
    B --> B2[行为数据]
    B --> B3[兴趣标签]
    
    C --> C1[内容分类]
    C --> C2[关键词提取]
    C --> C3[质量评分]
    
    D --> D1[协同过滤]
    D --> D2[内容匹配]
    D --> D3[深度学习]
    
    E --> E1[点击率CTR]
    E --> E2[停留时长]
    E --> E3[分享转发]
```

### **高级** 大规模系统优化
**题目：** 支持亿级用户的新闻推送系统如何设计？考虑性能、可用性、一致性。

```mermaid
graph TB
    subgraph "接入层"
        A[客户端] --> B[CDN]
        B --> C[负载均衡器]
    end
    
    subgraph "服务层"
        C --> D[API网关]
        D --> E[用户服务集群]
        D --> F[内容服务集群]
        D --> G[推荐服务集群]
        D --> H[推送服务集群]
    end
    
    subgraph "数据层"
        I[(主数据库)]
        J[(从数据库)]
        K[Redis集群]
        L[ElasticSearch]
        M[Kafka消息队列]
    end
    
    E --> I
    F --> J
    G --> K
    H --> L
    服务层 --> M
```

## ⚡ 核心算法设计

### 时间线生成算法

```mermaid
flowchart TD
    A[时间线生成] --> B{用户类型}
    
    B -->|普通用户| C[推模式]
    B -->|大V用户| D[拉模式]
    
    C --> C1[关注列表获取]
    C --> C2[预计算时间线]
    C --> C3[存储到用户Feed]
    
    D --> D1[实时拉取关注内容]
    D --> D2[按时间排序合并]
    D --> D3[个性化排序]
    
    C3 --> E[缓存优化]
    D3 --> E
    E --> F[返回给用户]
```

### 热点内容检测

```mermaid
graph TD
    A[热点检测] --> B[实时统计]
    A --> C[趋势分析]
    A --> D[机器学习]
    
    B --> B1[点赞/评论增长率]
    B --> B2[转发传播速度]
    B --> B3[用户参与度]
    
    C --> C1[时间窗口分析]
    C --> C2[同比环比增长]
    C --> C3[话题聚类]
    
    D --> D1[特征工程]
    D --> D2[模型训练]
    D --> D3[在线预测]
```

## 🛡️ 系统优化策略

### 缓存层次设计

```mermaid
graph LR
    A[用户请求] --> B[本地缓存L1]
    B --> C[分布式缓存L2]
    C --> D[数据库]
    
    B --> B1[JVM堆内缓存]
    C --> C1[Redis集群]
    C --> C2[Memcached]
    
    subgraph "缓存策略"
        E[Cache-Aside]
        F[Write-Through]
        G[Write-Behind]
    end
```

### 数据存储分层

```mermaid
graph TB
    A[数据分层] --> B[热数据]
    A --> C[温数据]
    A --> D[冷数据]
    
    B --> B1[内存存储]
    B --> B2[SSD存储]
    B --> B3[最近7天内容]
    
    C --> C1[SSD存储]
    C --> C2[7-30天内容]
    
    D --> D1[HDD存储]
    D --> D2[30天以上内容]
    D --> D3[归档压缩]
```

## 📈 性能优化

### 读写分离架构

```mermaid
sequenceDiagram
    participant User
    participant ReadAPI
    participant WriteAPI
    participant Master
    participant Slave1
    participant Slave2
    
    User->>WriteAPI: 发布内容
    WriteAPI->>Master: 写入主库
    Master->>Slave1: 同步数据
    Master->>Slave2: 同步数据
    
    User->>ReadAPI: 获取时间线
    ReadAPI->>Slave1: 读取数据
    Slave1->>ReadAPI: 返回结果
    ReadAPI->>User: 推送内容
```

### 分片策略

| 分片方式 | 优势 | 劣势 | 适用场景 |
|----------|------|------|----------|
| 用户ID分片 | 负载均衡 | 热点用户问题 | 用户数据存储 |
| 时间分片 | 查询效率高 | 热点时间问题 | 历史数据归档 |
| 内容类型分片 | 业务隔离 | 跨类型查询复杂 | 多媒体内容 |
| 混合分片 | 灵活性好 | 复杂度高 | 大规模系统 |

## 💡 面试要点总结

### 关键设计要点
1. **用户规模评估**：日活用户数、发布频率、读写比例
2. **性能目标**：响应时间、吞吐量、可用性指标
3. **存储容量规划**：内容大小、保存时长、增长预期
4. **成本控制**：存储成本、计算成本、带宽成本

### 技术选型考虑
- **数据库选择**：关系型 vs NoSQL vs 图数据库
- **缓存策略**：本地缓存 vs 分布式缓存
- **消息队列**：实时推送 vs 批量处理
- **搜索引擎**：全文检索 vs 推荐算法

### 扩展性设计
1. **水平扩展**：无状态服务、数据分片
2. **垂直扩展**：硬件升级、性能优化
3. **地域扩展**：CDN部署、就近访问
4. **功能扩展**：插件化架构、微服务拆分

## 🔗 相关链接

- [← 返回系统设计主页](./README.md)
- [缓存系统](./caching-systems.md)
- [推荐系统](./recommendation-system.md)
- [高并发处理](./high-concurrency.md)

---

*新闻推送系统是社交媒体的核心功能，体现了分布式系统设计的多个重要方面* 📰 